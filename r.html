<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>jQuery UI Resizable - Default functionality</title>
    <style>
      .resizable {
        width: 310px;
        margin-right: 10px;
        margin-bottom: 10px;
      }
      .resizable h3 {
        text-align: center;
        margin: 0;
        height: 30px;
      }
      .timer {
        height: 150px;
        width: 150px;
      }
    </style>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      href="https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

    <script>
      $(function() {
        let groups = [
          {
            label: "Group 1",
            left: 400,
            top: 500,
            width: 310,
            height: 310,
            timers: [1, 2, 3]
          }
        ];

        groups.forEach(group => {
          let resizable = document.createElement("div");
          resizable.setAttribute(
            "class",
            "bg-info resizable ui-widget-content"
          );
          resizable.setAttribute(
            "style",
            `top: ${group.top}px;
            left:${group.left}px;
              width: ${group.width}px;
              height: ${group.height}px;`
          );
          let groupDiv = document.createElement("div");
          groupDiv.setAttribute("class", "group");
          resizable.appendChild(groupDiv);
          let groupHeader = document.createElement("h3");
          groupHeader.setAttribute("class", "ui-widget-header");
          groupHeader.innerText = "" + group.label;
          groupDiv.appendChild(groupHeader);
          let timersContainer = document.createElement("div");
          timersContainer.classList = "d-flex flex-wrap";
          groupDiv.appendChild(timersContainer);
          $("body").append(resizable);
        });
        // <h3 class="ui-widget-header">Resizable</h3>
        //     <div class="d-flex flex-wrap">
        //       <div class="p-5 timer border border-dark">dhcd</div>
        //       <div class="p-5 timer border border-dark">dhcd</div>
        //       <div class="p-5 timer border border-dark">dhcd</div>
        //       <div class="p-5 timer border border-dark">dhcd</div>
        //     </div>
        // $("#createGroup").on("click", createGroup());
        // function createGroup() {
        //   let groupPosition = `top: 100px;left:10;
        //       width: 310px;
        //       height: 100px;`;
        // }
        $(".resizable").draggable({
          stop: function(event, ui) {
            if (isOverlap(event, ui)) {
              $(this).animate(ui.originalPosition, "slow");
              return;
            }
          }
        });
        $(".resizable").resizable({
          handles: "se,e",
          ghost: true,
          autoHide: true,

          stop: function(event, ui) {
            $(this).css("height", getHeight(event, ui));
            $(this).css("max-width", getMaxWidth(event, ui));
            $(this).css("width", getWidth(event, ui));
            if (isOverlap(event, ui)) {
              $(this).animate(ui.originalPosition, "slow");
              return;
            }
          }
        });
        function checkOverLapping(rect1, rect2) {
          return !(
            rect1.right < rect2.left ||
            rect1.left > rect2.right ||
            rect1.bottom < rect2.top ||
            rect1.top > rect2.bottom
          );
        }

        function isOverlap(event, ui) {
          let draggedGroup = ui.helper[0];
          let draggedRect = draggedGroup.getBoundingClientRect();
          let draggedId = draggedGroup.id;
          let allRects = document.getElementsByClassName("resizable");
          for (let index = 0; index < allRects.length; index++) {
            const id = allRects[index].id;
            if (id == draggedId) continue;
            const rect = allRects[index].getBoundingClientRect();
            console.log(rect);
            if (checkOverLapping(rect, draggedRect)) return true;
          }
          return false;

          // var overlap = !(
          //   rect1.right < rect2.left ||
          //   rect1.left > rect2.right ||
          //   rect1.bottom < rect2.top ||
          //   rect1.top > rect2.bottom
          // );
          // console.log(overlap);
        }
        function getHeight(event, ui) {
          return ui.element.context.childNodes[1].clientHeight;
        }
        function getWidth(event, ui) {
          let oldWidth = +ui.originalSize.width;
          let newWidth = +ui.size.width;
          let timerWidth = 150;
          if (oldWidth > newWidth) {
            return oldWidth - timerWidth + "px";
          } else if (oldWidth < newWidth) {
            if (oldWidth + timerWidth > newWidth) {
              return oldWidth + "px";
            }
          }
        }
        function getMaxWidth(event, ui) {
          let childs =
            ui.element.context.childNodes[1].childNodes[3].childElementCount;
          let width = childs * 150 + 10;
          return width;
        }
      });
    </script>
  </head>
  <body>
    <!-- <div class="cotainer">
      <div class="row p-3">
        <button class="btn btn-info">Create Group</button>
      </div>

      <div class="row p-3">
        <div id="elem1" class="resizable" class="ui-widget-content">
          <div class="group shaukat">
            <h3 class="ui-widget-header">Resizable</h3>
            <div class="d-flex flex-wrap">
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
            </div>
          </div>
        </div>
        <div id="elem2" class="resizable" class="ui-widget-content">
          <div class="bg-info group">
            <h3 class="ui-widget-header">Resizable</h3>
            <div class="d-flex flex-wrap">
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
            </div>
          </div>
        </div>
        <div id="elem3" class="resizable" class="ui-widget-content">
          <div class="bg-info group">
            <h3 class="ui-widget-header">Resizable</h3>
            <div class="d-flex flex-wrap">
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
              <div class="p-5 timer border border-dark">dhcd</div>
            </div>
          </div>
        </div>
      </div>
    </div> -->
  </body>
</html>
